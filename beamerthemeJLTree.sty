% Written and (C) by Jérôme Lelong <jerome.lelong@gmail.com>
% 2008 - 2018

% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; either version 3 of the License, or
% (at your option) any later version.

% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.

% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>. 


\ProvidesPackage{beamerthemeJLTree}

\newif\ifbeamer@tree@showhooks
\beamer@tree@showhookstrue

\DeclareOptionBeamer{hooks}[true]{\csname beamer@tree@showhooks#1\endcsname}

\ProcessOptionsBeamer
\mode
<presentation>

\setbeamertemplate{navigation symbols}{}
\usecolortheme{rose}
\mode
<presentation>
\useinnertheme[shadow=true]{rounded}% les block

\mode
<all>

\defbeamertemplate*{footline}{JLTree theme}
{
  \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
  \end{beamercolorbox}
  \hbox{%
    \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.25ex,dp=1ex,left]{author in head/foot}%
      \usebeamerfont{author in head/foot}\hspace*{2ex}\insertshortauthor %
      \if\beamer@shortinstitute\empty\else\hspace*{1ex}(\insertshortinstitute)\fi%
      \usebeamerfont{date in head/foot}\hspace*{2ex}%
      \hspace*{2ex} \if\beamer@shortdate\empty\insertdate\else\insertshortdate\fi%
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
      \usebeamerfont{date in head/foot}
      \insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
    \end{beamercolorbox}}%
}


\defbeamertemplate*{sidebar right}{JLTree theme}{}

\usesectionheadtemplate
{\hfil\insertsectionhead}
{\hfill\color{fg!50!bg}\insertsectionhead}


\usesubsectionheadtemplate
{\hfil\insertsubsectionhead}
{\hfill\color{fg!50!bg}\insertsubsectionhead}



\defbeamertemplate*{headline}{JLTree theme}
{%
  \leavevmode%
  \begin{beamercolorbox}[wd=\paperwidth,colsep=1.5pt]{upper separation line head}
  \end{beamercolorbox}
  \@tempdimb=3.625ex% 2.4375ex%
  \multiply\@tempdimb by\beamer@sectionmax%
%%  \advance\@tempdimb by 1.125ex%
  \advance\@tempdimb by -1.125ex%
  \ifdim\@tempdimb<10.9ex% 3*(2.5+1.125)
     \@tempdimb=10.9ex%
  \fi
  \begin{beamercolorbox}[wd=.45\paperwidth, ht=\@tempdimb]{left block}%
    \usebeamerfont{section in head/foot}%
    \vbox to\@tempdimb{\vfill\insertsectionnavigation{.45\paperwidth}\vfill}%
    \advance\@tempdimb 1.125ex%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=1.125ex,ht=\@tempdimb]{middle separation line head}%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.40\paperwidth]{middle block}%
    \vbox to\@tempdimb{\vfill%
    \begin{beamercolorbox}[wd=.40\paperwidth,ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
      \usebeamerfont{title in head/foot}\insertshorttitle
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=.40\paperwidth,ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{section in head/foot}
      \usebeamerfont{section in head/foot}%
      \ifbeamer@tree@showhooks
      \setbox\beamer@tempbox=\hbox{\insertsectionhead}%
      \ifdim\wd\beamer@tempbox>1pt%
      \hskip2pt\raise1.9pt\hbox{\vrule width0.4pt height1.875ex\vrule width 5pt height0.4pt}%
      \hskip1pt%
      \fi%
      \else%
      \hskip6pt%
      \fi%
      \insertsectionhead
    \end{beamercolorbox}
    \begin{beamercolorbox}[wd=.40\paperwidth,ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm plus1fil]{subsection in head/foot}
      \usebeamerfont{subsection in head/foot}%
      \ifbeamer@tree@showhooks
      \setbox\beamer@tempbox=\hbox{\insertsubsectionhead}%
      \ifdim\wd\beamer@tempbox>1pt%
      \hskip9.4pt\raise1.9pt\hbox{\vrule width0.4pt height1.875ex\vrule width 5pt height0.4pt}%
      \hskip1pt%
      \fi%
      \else%
      \hskip12pt%
      \fi%
      \insertsubsectionhead
    \end{beamercolorbox}%
    \vfill}%
  \end{beamercolorbox}
  \begin{beamercolorbox}[wd=.11\paperwidth,ht=\@tempdimb,right]{right block}%
    \vbox to\@tempdimb{\vfill\insertlogo\vfill}
  \end{beamercolorbox}
  \vfill
  \begin{beamercolorbox}[wd=\paperwidth,colsep=1.5pt]{lower separation line head}
  \end{beamercolorbox}
}
\mode <presentation>
\setbeamercolor{separation line}{use=structure,bg=structure.fg!50!bg}
\mode <handout>
\setbeamercolor{separation line}{use=structure,bg=black}
\setbeamercolor{block title}{use=structure,fg=black,bg=white}
\setbeamercolor{block body}{parent=normal text,use=block title,bg=white}
\setbeamercolor{frametitle}{fg=black}
\mode
<all>
